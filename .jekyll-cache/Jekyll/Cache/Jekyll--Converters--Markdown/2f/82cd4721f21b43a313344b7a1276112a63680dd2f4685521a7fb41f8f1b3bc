I"¯<blockquote>
  <p>åœ¨åšPet Dayçš„æ—¶å€™ï¼Œé‡åˆ°ä¸€ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œå‡å®š<code class="language-plaintext highlighter-rouge">tableView</code>ä¸­çš„sectionåˆå§‹å€¼ä¸º50,åœ¨å¾€ä¸Šæˆ–è€…å¾€ä¸‹çš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡è®¡ç®—å¾—çŸ¥æ›´å¤šçš„<code class="language-plaintext highlighter-rouge">dataSource</code></p>
</blockquote>

<p>ç„¶åæˆ‘ä¸€å¼€å§‹çš„åšæ³•ï¼Œæ˜¯åœ¨<code class="language-plaintext highlighter-rouge">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath;</code>çš„æ–¹æ³•åœ¨æ¥è¿‘é¡¶éƒ¨æˆ–è€…æ¥è¿‘åº•éƒ¨çš„æ—¶å€™ï¼Œè¿›è¡Œè®¡ç®—</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="n">_</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="p">,</span>
                   <span class="n">willDisplay</span> <span class="nv">cell</span><span class="p">:</span> <span class="kt">UITableViewCell</span><span class="p">,</span>
                   <span class="n">forRowAt</span> <span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//å¦‚æœå¤§äºæ•°æ®æºæ€»æ•°-30ï¼Œéœ€è¦å¼€å§‹è®¡ç®—åé¢çš„å†…å®¹</span>
        <span class="k">if</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">section</span> <span class="o">&gt;</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">30</span> <span class="p">{</span>
           
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="n">indexPath</span><span class="o">.</span><span class="n">section</span> <span class="o">&lt;</span> <span class="mi">30</span> <span class="p">{</span><span class="c1">//å¦‚æœå°äº30ï¼Œéœ€è¦å¼€å§‹è®¡ç®—å‰é¢çš„å†…å®¹</span>
           
    <span class="p">}</span>
</code></pre></div></div>
<hr />
<p><strong>ä½†æ˜¯ï¼Œè¿™æ ·åšä¼šæœ‰é—®é¢˜</strong>ï¼Œåœ¨é‡åˆ°å‘ä¸Šåˆ·æ–°çš„æ—¶å€™ï¼Œä¼šå¤šæ¬¡è°ƒç”¨<code class="language-plaintext highlighter-rouge">- (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath;</code>çš„æ–¹æ³•ï¼Œå¯¼è‡´æ•°æ®çªç„¶å¢å¤šã€‚</p>

<p>åæ¥ç”¨å®šæ—¶å™¨å®ç°è§¦å‘å0.5ç§’å†…æ‹¦æˆªï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">guard</span> <span class="n">share</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">timer</span> <span class="o">=</span> <span class="kt">Timer</span><span class="o">.</span><span class="nf">bs_scheduledTimer</span><span class="p">(</span><span class="nv">withTimeInterval</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span> <span class="nv">block</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">timer</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">weak</span> <span class="k">var</span> <span class="nv">weakTimer</span> <span class="o">=</span> <span class="n">timer</span>

            <span class="n">weakTimer</span><span class="p">?</span><span class="o">.</span><span class="nf">invalidate</span><span class="p">()</span>
            <span class="n">weakTimer</span> <span class="o">=</span> <span class="kc">nil</span>
        <span class="p">},</span> <span class="nv">repeats</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="n">share</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="nf">fire</span><span class="p">()</span>
        <span class="nf">shareRunLoop</span><span class="p">()</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span> <span class="nv">forMode</span><span class="p">:</span> <span class="o">.</span><span class="n">defaultRunLoopMode</span><span class="p">)</span>

</code></pre></div></div>

<h3 id="è¿™æ—¶å€™runloopçš„å‘å°±æ¥äº†"><strong>è¿™æ—¶å€™RunLoopçš„å‘å°±æ¥äº†</strong></h3>
<p>ç¬¬ä¸€æ¬¡è§¦å‘â€¦æ­£å¸¸<br />
ç¬¬äºŒæ¬¡è§¦å‘â€¦0.5ç§’è¿‡äº†ï¼Œå¥½å‡ ç§’è¿‡å»äº†ï¼Œè¿˜æ˜¯æ²¡æœ‰ååº”<br />
â€¦<br />
ç»ˆäºåœ¨åœæ­¢åˆ·æ–°åï¼Œå†å¾€ä¸Šåˆ·ï¼Œæ­£å¸¸äº†</p>

<p>åŸå› æ˜¯TableViewåœ¨æ»‘åŠ¨çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹çš„Runloopä¼šåˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œè¿™æ—¶å€™åªä¼šæ‰§è¡ŒUITrackingRunLoopModeä¸‹çš„ä»»åŠ¡ï¼Œç­‰UITrackingRunLoopModeçš„ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå†åˆ‡æ¢åˆ°NSDefaultRunLoopModeæ‰ä¼šæ‰§è¡Œå®šæ—¶å™¨ã€‚<br />
æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥æŠŠåŠ å…¥åˆ°å®šæ—¶å™¨çš„æ—¶å€™å°†Runloopè®¾ç½®ä¸ºNSRunLoopCommonModes</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">runLoop</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="kt">NSMachPort</span><span class="p">(),</span> <span class="nv">forMode</span><span class="p">:</span> <span class="o">.</span><span class="n">commonModes</span><span class="p">)</span>
</code></pre></div></div>
<p>æˆ–è€…æ”¹ç”¨GCDå®ç°</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        
        <span class="k">guard</span> <span class="n">share</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
            <span class="nf">operation</span><span class="p">()</span>
        
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="kt">DispatchTime</span><span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">interval</span><span class="p">,</span> <span class="nv">execute</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">share</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="p">})</span>
        
        <span class="n">share</span><span class="o">.</span><span class="n">operations</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
</code></pre></div></div>
:ET